{% extends 'base.html.twig' %}

{% block title %}Produit index{% endblock %}

{% block body %}
    <h1>Produit index</h1>

    <div class="row">
        <div class="col">
            <form id="search-form">
                <div class="form-group">
                    <input type="text" id="filter" placeholder="Filter by nom" value="{{ filter }}" class="form-control">
                    <!-- Remove the submit button -->
                </div>
            </form>
        </div>
    </div>

    <div class="row" id="product-list">
        <!-- Product listing will be populated dynamically -->
    </div>

    <a href="{{ path('app_produit_new') }}" class="btn btn-success">Create New</a>

    <script>
        // JavaScript for AJAX search
        document.addEventListener('DOMContentLoaded', function () {
            const filterInput = document.getElementById('filter');
            const productList = document.getElementById('product-list');

            filterInput.addEventListener('input', function () {
                const filterValue = filterInput.value.trim();

                // Send AJAX request
                fetch('{{ path('app_produit_index') }}?filter=' + filterValue, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json()) // Change response type to JSON
                .then(data => {
                    // Clear existing product listing
                    productList.innerHTML = '';

                    // Populate product listing with retrieved data
                    data.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'col-lg-3 col-md-4 col-sm-6 mb-4';
                        productCard.innerHTML = `
                            <div class="card">
                                <a href="/produit/${product.id}">
                                    <img src="/${product.image}" alt="Product Image" class="card-img-top" width="100" height="100">
                                </a>
                                <div class="card-body">
                                    <h5 class="card-title">${product.name}</h5> <!-- Display product name -->
                                    <p class="card-text">Price: ${product.price}</p> <!-- Display product price -->
                                    <!-- Add more properties as needed -->
                                </div>
                            </div>
                        `;
                        productList.appendChild(productCard);
                    });
                })
                .catch(error => console.error('Error:', error));
            });
        });
    </script>
{% endblock %}
